# 数据库
<!-- GFM-TOC -->
* mysql
  * [mysql索引为什么用B+树实现？](#mysql索引为什么用B+树实现?)
  * [float、double和decimal区别？](#float、double和decimal区别?)
* redis
  * [redis哨兵主要功能？](#redis哨兵主要功能?)
  * [redis主从复制、哨兵和集群区别？](#redis主从复制、哨兵和集群区别?)
  * [缓存穿透+击穿+雪崩区别？](#缓存穿透+击穿+雪崩区别?)
<!-- GFM-TOC -->

## mysql

### mysql索引

#### 索引原理

* InnoDB使用的是聚簇索引，第一步在辅助索引B+树中检索，到达其叶子节点获取对应的主键。第二步使用主键索引B+树种再执行一次B+树检索操作，最终到达叶子节点即可获取整行数据。
* MyISAM使用的是非聚簇索引，第一步在辅助索引B+树中检索，到达其叶子节点获取数据记录的地址。第二步通过数据记录的地址，在数据文件找到记录。

#### MyISAM与InnoDB索引比较

* MyISAM索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。InnoDB主索引文件就包含数据；
* MyISAM主索引和辅助索引在结构上没有任何区别，只是主索引要求key是唯一的，而辅助索引的key可以重复；

> <https://www.cnblogs.com/rjzheng/p/9915754.html>

#### B+Tree和B-Tree区别

* 非叶子节点只存储键值信息。
* 所有叶子节点之间都有一个链指针。
* 数据记录都存放在叶子节点中。

> <https://www.cnblogs.com/Transkai/p/11595405.html>

#### 聚簇索引优势

看上去聚簇索引的效率明显要低于非聚簇索引，因为每次使用辅助索引检索都要经过两次B+树查找，这不是多此一举吗？聚簇索引的优势在哪？

* 由于行数据和叶子节点存储在一起，这样主键和行数据是一起被载入内存的，找到叶子节点就可以立刻将行数据返回。
* 辅助索引使用主键作为"指针"，而不是使用地址值作为指针。优点是主键B+树的节点如何变化，辅助索引树都不受影响。

#### mysql索引为什么用B+树实现

* B+树能显著减少IO次数，提高效率；
* B+树查询效率更加稳定，因为数据放在叶子节点；
* B+树能提高范围查询的效率，因为叶子节点指向下一个叶子节点。

### float、double和decimal区别

* float单精度，4字节，32位；
* double双精度，8字节，64位；
* decimal小数值，官方唯一指定能精确存储的类型；

> 数据转成二进制后，只能截取前32位或64位进行存储，然后读取后将会出现误差。

## redis

### redis哨兵主要功能

* 集群监控：负责监控Redis master和slave进程是否正常工作；
* 消息通知：如果某个Redis实例有故障，那么哨兵负责发送消息作为报警通知给管理员；
* 故障转移：如果master node挂掉了，会自动转移到slave node上；
* 配置中心：如果故障转移发生了，通知client客户端新的master地址。

### redis主从复制、哨兵和集群区别

主从复制是为了数据备份，哨兵是为了高可用，redis主服务器挂了哨兵可以切换，集群则是因为单实例能力有限，搞多个分散压力。

### 缓存穿透+击穿+雪崩区别

* 缓存穿透：查询一个一定不存在的数据。
* 缓存击穿：大量的请求同时查询一个key时，此时这个key正好失效了。
* 缓存雪崩：当某一时刻发生大规模的缓存失效的情况。

缓存穿透解决方案：

* 缓存空值
* 用布隆过滤器BloomFilter：查询前去BloomFilter查询key是否存在

缓存击穿解决方案：

* 互斥锁

缓存雪崩解决方案：

* 雪崩前：使用集群缓存，保证缓存服务的高可用。
* 雪崩中：ehcache本地缓存 + Hystrix限流 & 降级，避免MySQl被打死。
* 雪崩后：开启Redis持久化，尽快恢复缓存集群。

## elastic search

### ik分词模式

ik分词器有两种分词模式：ik_max_word和ik_smart模式。

* 会将文本做最细粒度的拆分，比如会将“中华人民共和国人民大会堂”拆分为“中华人民共和国、中华人民、中华、华人、人民共和国、人民、共和国、大会堂、大会、会堂等词语。
* 会做最粗粒度的拆分，比如会将“中华人民共和国人民大会堂”拆分为中华人民共和国、人民大会堂。

### 倒排索引

倒排索引也叫反向索引，通俗来讲正向索引是通过key找value，反向索引则是通过value找key。

#### term index

就像字典里的索引页一样，先快速定位offset，然后通过顺序查找，结合FST(Finite State Transducers)的压缩技术，term index以树的形式缓存在内存中。

#### term dictionary

就像字典里的字典一样，将所有的term排个序，二分法查找term，logN的查找效率。
